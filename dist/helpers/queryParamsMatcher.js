"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMockedEndpointForQuery=exports.findQueryMatches=exports.endpointsInProject=exports.extractPathForURL=void 0;const lodash_1=__importDefault(require("lodash")),queryParser_1=require("./queryParser");exports.extractPathForURL=(e=>{const t=e.split("/")[1];return e.split("?")[0].replace(`/${t}`,"")}),exports.endpointsInProject=((e,t)=>{if(!e||!t||!t.endpoints)return null;const r=[],o=Object.keys(e);for(const s of o){if(lodash_1.default.find(t.endpoints,e=>e===s)){const t=e[s];r.push(t)}}return r}),exports.findQueryMatches=((e,t)=>{const r=queryParser_1.parseQuery(e),o=Object.keys(r),s=Object.keys(t);let n=!0;for(const e of o)if(s.includes(e)){const o=r[e],s=t[e];o.toString()!==s.toString()&&(n=!1)}else n=!1;return n}),exports.getMockedEndpointForQuery=((e,t,r)=>{const o=r.originalUrl.split("/")[1],s=exports.extractPathForURL(r.originalUrl),n=r.method,i=lodash_1.default.find(e,e=>e.slug===o),u=exports.endpointsInProject(t,i);if(!u)return[];const a=[];for(const e of u)if(e.enable){const t=e.path,o=e.method;if(t!==s||o!==n)continue;exports.findQueryMatches(e.request.params,r.query)&&a.push(e)}return a});