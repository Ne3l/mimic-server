"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const lodash_1=__importDefault(require("lodash")),queryParser_1=require("./queryParser");exports.extractPathForURL=(e=>{const t=e.split("/")[1];return e.split("?")[0].replace(`/${t}`,"")}),exports.endpointsInProject=((e,t)=>{if(!e||!t||!t.endpoints)return null;const r=[],o=Object.keys(e);for(const s of o){if(lodash_1.default.find(t.endpoints,e=>e===s)){const t=e[s];r.push(t)}}return r}),exports.findQueryMatches=((e,t)=>{const r=queryParser_1.parseQuery(e),o=Object.keys(r),s=Object.keys(t);let n=!0;for(const e of o)if(s.includes(e)){const o=r[e],s=t[e];o.toString()!==s.toString()&&(n=!1)}else n=!1;return n}),exports.simplifyBody=(e=>e?e.trim().replace(/["']/g,""):void 0),exports.getMockedEndpointForQuery=((e,t,r)=>{const o=r.originalUrl.split("/")[1],s=exports.extractPathForURL(r.originalUrl),n=r.method,i=lodash_1.default.find(e,e=>e.name===o),p=exports.endpointsInProject(t,i);if(!p)return null;const u=[],a=exports.simplifyBody(String(r.body));for(const e of p){const t=e.path,o=e.method,i=a!==exports.simplifyBody(JSON.stringify(e.request.body)),p="POST"===o.toUpperCase()||"PUT"===o.toUpperCase();t!==s||o!==n||i&&p||exports.findQueryMatches(e.request.params,r.query)&&u.push(e)}return u});